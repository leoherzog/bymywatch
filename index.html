<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
      article {
        max-width: 50vw;
        margin-left: auto;
        margin-right: auto;
      }
      article > p {
        text-align: center;
      }
      #solarSystemChart {
        font-size: 1rem;
        width: 100%;
        height: auto;
        max-width: 500px;
        max-height: 500px;
        aspect-ratio: 1 / 1;
        margin-left: auto;
        margin-right: auto;
        border: 1px solid white;
        border-radius: 50%;
        position: relative;
      }
      #sun,
      #mercury,
      #venus,
      #us,
      #mars,
      #jupiter,
      #saturn,
      #uranus,
      #neptune {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-bottom: 0;
        cursor: default;
        font-family: system-ui, sans-serif;
      }
      #sun {
        font-size: 3rem;
      }
      #moon {
        font-size: 0.6rem;
        position: absolute;
        top: 6px;
        left: 6px;
        cursor: default;
      }
      @media screen and (max-width: 1024px) {
        article {
          max-width: 100%;
        }
        #sun {
          font-size: 2rem;
        }
      }
    </style>
    <script src='https://cdn.jsdelivr.net/npm/temporal-polyfill@latest/global.min.js'></script>
  </head>
  <body>
    <header class="container">
      <hgroup>
        <h1>By My Watch</h1>
        <h2>The ways that humans represent time.</h2>
      </hgroup>
    </header>

    <main class="container">
      <article id="solarSystem">
        <figure id="solarSystemChart">
          <span id="sun">&#9728;&#65039;</span>
          <span id="mercury" data-tooltip="Mercury">&#9791;</span>
          <span id="venus" data-tooltip="Venus">&#9792;</span>
          <span id="us">
            <span id="earth">&#127757;</span>
            <span id="moon">&#127764;</span>
          </span>
          <span id="mars" data-tooltip="Mars">&#9794;</span>
          <span id="jupiter" data-tooltip="Jupiter">&#9795;</span>
          <span id="saturn" data-tooltip="Saturn">&#9796;</span>
          <span id="uranus" data-tooltip="Uranus">&#9797;</span>
          <span id="neptune" data-tooltip="Neptune">&#9798;</span>
        </figure>
      </article>

      <article id="your">
        <header>Your Local Time</header>
        <p id="yourTime"></p>
      </article>

      <article id="utc">
        <header>Universal Coordinated Time (<a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time" target="_blank">UTC</a>)</header>
        <p id="utcTime"></p>
        <footer>
          <small>Which is actually a different thing than Greenwich Mean Time <a href="https://en.wikipedia.org/wiki/Greenwich_Mean_Time" target="_blank">(GMT)</a>!</small>
        </footer>
      </article>

      <article id="beat">
        <header>
          <a href="https://en.wikipedia.org/wiki/Swatch_Internet_Time" target="_blank">Swatch Internet Time</a>
        </header>
        <p id="beatTime"></p>
        <progress id="beatTimeTimeline" max="1000"></progress>
        <footer>
          <small>Also known as <strong>.beat</strong> time.</small>
        </footer>
      </article>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        tick();
        setInterval(tick, 16.666); // 60Hz
      });

      const solarSystemChart = document.getElementById('solarSystemChart');
      const sun = document.getElementById('sun');
      const mercury = document.getElementById('mercury');
      const venus = document.getElementById('venus');
      const us = document.getElementById('us');
      const earth = document.getElementById('earth');
      const moon = document.getElementById('moon');
      const mars = document.getElementById('mars');
      const jupiter = document.getElementById('jupiter');
      const saturn = document.getElementById('saturn');
      const uranus = document.getElementById('uranus');
      const neptune = document.getElementById('neptune');
      const yourTime = document.getElementById('yourTime');
      const utcTime = document.getElementById('utcTime');
      const beatTime = document.getElementById('beatTime');
      const beatTimeTimeline = document.getElementById('beatTimeTimeline');

      let now = Temporal.Now.instant();
      let zonedNow = Temporal.Now.zonedDateTimeISO();

      function tick() {
        now = Temporal.Now.instant();
        zonedNow = Temporal.Now.zonedDateTimeISO();

        // console.log(now.toString());
        // console.log(zonedNow.toString());

        // solar system
        const epochStart = Temporal.Instant.from('1970-01-01T00:00:00Z');
        const daysSinceEpoch = Number(now.since(epochStart, { "largestUnit": "hour" }).total('days'));
        const chartSize = solarSystemChart.offsetWidth;
        const baseDistance = chartSize / 5;
        const planets = {
          "mercury": { "period": 88, "startAngle": 17.67, "distance": baseDistance * 0.5 },
          "venus": { "period": 224.7, "startAngle": 354.74, "distance": baseDistance * 0.75 },
          "us": { "period": 365.25, "startAngle": 0, "distance": baseDistance },
          "mars": { "period": 687, "startAngle": 61.5, "distance": baseDistance * 1.25 },
          "jupiter": { "period": 4333, "startAngle": 290.63, "distance": baseDistance * 1.5 },
          "saturn": { "period": 10759, "startAngle": 110.56, "distance": baseDistance * 1.75 },
          "uranus": { "period": 30687, "startAngle": 266.85, "distance": baseDistance * 2 },
          "neptune": { "period": 60190, "startAngle": 317.93, "distance": baseDistance * 2.25 },
        };

        Object.entries(planets).forEach(([planet, data]) => {
          const degreesPerDay = 360 / data.period;
          const currentAngle = (Math.round((data.startAngle + daysSinceEpoch * degreesPerDay) % 360) - 90 + 360) % 360;
          const planetElement = document.getElementById(planet);
          if (planetElement) {
            planetElement.style.transform = 'translate(-50%, -50%) rotate(' + currentAngle + 'deg) translateX(' + data.distance + 'px) rotate(-' + currentAngle + 'deg)';
          }
        });
        const utcHour = now.toZonedDateTimeISO('UTC').hour;
        switch (true) {
          case utcHour < 6:
            earth.innerHTML = '&#127759;'; // Asia/Australia
            break;
          case utcHour < 14:
            earth.innerHTML = '&#127757;'; // Europe/Africa
            break;
          case utcHour < 22:
            earth.innerHTML = '&#127758;'; // Americas
            break;
          default:
            earth.innerHTML = '&#127759;';
        }

        // moon
        const moonPeriod = 29.5305;
        const startLunarAge = 22.69;
        const currentPhase = (daysSinceEpoch + startLunarAge) % moonPeriod;
        switch (true) {
          case currentPhase < 1.84566:
            moon.innerHTML = '&#127761;';
            break;
          case currentPhase < 5.53699:
            moon.innerHTML = '&#127762;';
            break;
          case currentPhase < 9.22831:
            moon.innerHTML = '&#127763;';
            break;
          case currentPhase < 12.91963:
            moon.innerHTML = '&#127764;';
            break;
          case currentPhase < 16.61096:
            moon.innerHTML = '&#127765;';
            break;
          case currentPhase < 20.30228:
            moon.innerHTML = '&#127766;';
            break;
          case currentPhase < 23.99361:
            moon.innerHTML = '&#127767;';
            break;
          case currentPhase < 27.68493:
            moon.innerHTML = '&#127768;';
            break;
          case currentPhase < 29.53:
            moon.innerHTML = '&#127761;';
            break;
          default:
            moon.innerHTML = '&#127771;';
        }
        const moonOrbitRadius = 24;
        const moonPhaseAngle = (currentPhase / moonPeriod) * 360;
        moon.style.transform = 'rotate(' + moonPhaseAngle + 'deg) translate(' + moonOrbitRadius + 'px)';

        // local time
        yourTime.innerHTML = zonedNow.toLocaleString('en-US', {
          "hour": "numeric",
          "minute": "numeric",
          "second": "numeric",
          "timeZoneName": "short"
        });

        // intl utc time
        utcTime.innerHTML = now.toZonedDateTimeISO('UTC').toLocaleString('en-US', {
          "hour": "numeric",
          "minute": "numeric",
          "second": "numeric",
          "timeZoneName": "short"
        });

        // beat time (swatch time)
        const utcSeconds = (utcTime.hour * 3600) + (utcTime.minute * 60) + utcTime.second;
        const beat = (utcSeconds / 86.4) % 1000;
        beatTime.innerHTML = '@' + beat.toFixed(2) + ' .beats';
        beatTimeTimeline.value = beat;
      }
    </script>
    <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "d5f7a4bd66394258918237b45456ffdf"}'></script>
  </body>
</html>
